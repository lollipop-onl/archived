# 仕様

## できること

スマートフォン、カメラなどで撮影した画像・映像を S3 Glacier にアップロードして格安バックアップとして運用する

- 写真をアップロードすると S3 Glacier に保存される
- アップロードされる際に S3 Standard に webp フォーマットのサムネイルが保存される
- 写真はまとめてアップロードできる
- メタデータから画像を絞り込める
- 撮影者をメタデータとして登録できる

## アップロードのながれ

- アップロードする画像を選択する（複数選択可）
- 画像は S3 Standard のバケットにアップロードされる
- S3 Standard へのアップロードの完了を元にバッチを起動する
- バッチでは次の処理を行う
  - 進行状況をデータベースに登録
  - ファイル名をユニークで意味のあるものに変更
  - メタデータをデータベースに登録
  - S3 Glacier への転送
  - サムネイルを作成し S3 Standard へアップロード
- バッチ処理が完了したら暫定バケットの画像データを削除する

## ダウンロードの流れ

ダウンロードではなく、オリジナル版をリクエストするような仕組みにする。

- リクエストする画像を選択する（条件検索可）
- 選択した画像はログインユーザーごとに保持する
- 復元状況をデータベースに登録
- S3 Glacier から復元されたら S3 Standard に出力させる
- 復元されたらメタデータにフラグを立てる
- 復元された画像は一覧からオリジナル版を表示できる
- 一定期間が経過したらスケジュールバッチで削除
